
<div class="container">

  <h1 class="mt-3">Community</h1>
  
  <% if logged_in? %>

    <% if @post.errors.any? %>
      <div id = "error_explanation">
        <div class="alert alert-danger">
          The form contains <%= pluralize(@post.errors.count,"error") %>
        </div>
        <ul>
          <% @post.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
  
    <%= form_for @post do |f| %>
      <%= f.text_area :content %>
      <%= f.submit "投稿する", class:"btn btn-primary" %>
    <% end %>

    <%= link_to "投稿削除", user_path(current_user.id) %>
    <hr>
    
    <h2 class="mt-5">投稿一覧</h2>
    <% @posts.each do |post| %>
      <small>投稿者</small>：<a href="/users/<%= post.user.id %>"><%= post.user.name %></a>
      <p><small>内容</small>：<a href="/posts/<%= post.id %>"><%= post.content %></a></p>
      <small>投稿時間：<%= l post.created_at %></small>
      <br>
      <small class="">コメント数：<%= post.comments.count %></small>
      <small class="ml-3"><a href="/posts/<%= post.id %>">コメントする</a></small>
      <small class="">コメント：</small>
      
      <% post.comments.each do |c| %>
        <div class="row">
          <div class="mb-3 col-10">
            <span class="ml-3"><%= c.content %></span>
            <br>
          </div>
          <% if current_user.id == c.user.id %>
            <div class="col-2">
              <%= link_to "削除", post_comment_path(c.post.id,c.id) ,method: :delete,
                                            data: { confirm: "削除してよろしいですか?" } %>
            </div>
          <% end %>
        </div>
      <% end %>
      <hr>      
    <% end %>

    <div class="mt-5">
      <%= paginate @posts %>
    </div>

  <% else %>
    <%= link_to "ユーザー登録", new_user_path %>
    <%= link_to "ログイン", login_path %>
  <% end %>

</div>